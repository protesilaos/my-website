---
layout: page
title: 'Change Log of Dired Preview'
subtitle: 'Automatically preview files in Dired'
excerpt: "dired-preview is a simple and robust package to automatically preview in a side window the file at point in Dired buffers."
permalink: /emacs/dired-preview-changelog
---

<p>
This document contains the release notes for each tagged commit on the
project&rsquo;s main git repository: <a href="https://github.com/protesilaos/dired-preview">https://github.com/protesilaos/dired-preview</a>.
</p>

<p>
The newest release is at the top.  For further details, please consult
the manual: <a href="https://protesilaos.com/emacs/dired-preview">https://protesilaos.com/emacs/dired-preview</a>.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:cdb4ee0e-5fd3-4958-9655-8b3ee6118755">1. Version 0.6.0 on 2025-07-18</a></li>
<li><a href="#h:bbcb8fc7-5738-4761-b0e8-853d74172a5a">2. Version 0.5.0 on 2025-04-09</a></li>
<li><a href="#h:af454ee4-dcae-4a76-80c7-d4f9be7730c7">3. Version 0.4.0 on 2025-02-18</a></li>
<li><a href="#h:d9780c65-4e70-4188-ae17-abdef97f7ea9">4. Version 0.3.0 on 2024-09-16</a></li>
<li><a href="#h:4225d638-f5bb-4855-85c7-972ff40aad6d">5. Version 0.2.0 on 2024-05-07</a></li>
<li><a href="#h:99cbb3dd-a0f1-4d2b-a945-58531f4ab189">6. Version 0.1.0 on 2023-07-08</a></li>
</ul>
</div>
</div>
<div id="outline-container-h:cdb4ee0e-5fd3-4958-9655-8b3ee6118755" class="outline-2">
<h2 id="h:cdb4ee0e-5fd3-4958-9655-8b3ee6118755"><span class="section-number-2">1.</span> Version 0.6.0 on 2025-07-18</h2>
<div class="outline-text-2" id="text-h:cdb4ee0e-5fd3-4958-9655-8b3ee6118755">
<p>
This is a small release that provides quality-of-life refinements.
</p>
</div>
<div id="outline-container-h:b6b61050-6827-405b-8fc8-ee0ee51f1418" class="outline-3">
<h3 id="h:b6b61050-6827-405b-8fc8-ee0ee51f1418"><span class="section-number-3">1.1.</span> Optionally do not trigger a preview when entering the directory</h3>
<div class="outline-text-3" id="text-h:b6b61050-6827-405b-8fc8-ee0ee51f1418">
<p>
The new user option <code>dired-preview-trigger-on-start</code> controls whether
a preview is produced automatically when (i) entering a directory
while (ii) the <code>dired-preview-mode</code> or its global counterpart is
enabled.
</p>

<p>
The default value is non-<code>nil</code>, which preserves the behaviour we have
always had of previewing outright. When set to <code>nil</code>, the preview does
not happen upon entering a directory and is triggered only after one
of the commands in <code>denote-preview-trigger-commands</code> is invoked.
</p>

<p>
I did this is in response to issue 31 by dasoju: <a href="https://github.com/protesilaos/dired-preview/issues/31">https://github.com/protesilaos/dired-preview/issues/31</a>.
</p>
</div>
</div>
<div id="outline-container-h:20db592a-a282-4a63-a0f2-d64a6ded8ac2" class="outline-3">
<h3 id="h:20db592a-a282-4a63-a0f2-d64a6ded8ac2"><span class="section-number-3">1.2.</span> Define which commands trigger a preview</h3>
<div class="outline-text-3" id="text-h:20db592a-a282-4a63-a0f2-d64a6ded8ac2">
<p>
The <code>denote-preview-trigger-commands</code> is now declared as a &ldquo;user
option&rdquo; rather than a generic variable, meaning that users are
encouraged to customise it (and it technically is available via the
Custom interface and related). Everything should otherwise work the
same as before.
</p>
</div>
</div>
<div id="outline-container-h:96178e26-80b4-4717-85b8-e51a2f6c17e4" class="outline-3">
<h3 id="h:96178e26-80b4-4717-85b8-e51a2f6c17e4"><span class="section-number-3">1.3.</span> The preview does not interfere with <code>dired-dwim-target</code></h3>
<div class="outline-text-3" id="text-h:96178e26-80b4-4717-85b8-e51a2f6c17e4">
<p>
Previous versions would make <code>dired-dwim-target</code> not return the
directory of the other window. Whereas we want the preview to not
influence how Dired behaves when copying or renaming files.
</p>

<p>
The bug was addressed in patch release <code>0.5.2</code>.
</p>
</div>
</div>
<div id="outline-container-h:cc578a93-b441-4ddc-9f82-a3b643a80ab1" class="outline-3">
<h3 id="h:cc578a93-b441-4ddc-9f82-a3b643a80ab1"><span class="section-number-3">1.4.</span> Fixed a temporary bug in <code>dired-preview-page-up</code></h3>
<div class="outline-text-3" id="text-h:cc578a93-b441-4ddc-9f82-a3b643a80ab1">
<p>
It was missing the macro we define to perform operations in the
preview window.
</p>

<p>
Thanks to Alex Popescu for telling me that the command was not
working. This was done in issue 28: <a href="https://github.com/protesilaos/dired-preview/issues/28">https://github.com/protesilaos/dired-preview/issues/28</a>.
</p>

<p>
The bug was addressed in patch release <code>0.5.1</code>.
</p>
</div>
</div>
</div>
<div id="outline-container-h:bbcb8fc7-5738-4761-b0e8-853d74172a5a" class="outline-2">
<h2 id="h:bbcb8fc7-5738-4761-b0e8-853d74172a5a"><span class="section-number-2">2.</span> Version 0.5.0 on 2025-04-09</h2>
<div class="outline-text-2" id="text-h:bbcb8fc7-5738-4761-b0e8-853d74172a5a">
<p>
This version contains a few bug fixes and minor refinements that
should improve the behaviour of the package.
</p>
</div>
<div id="outline-container-h:0a4464ac-2f21-4c1e-8202-3bfe0b4eff93" class="outline-3">
<h3 id="h:0a4464ac-2f21-4c1e-8202-3bfe0b4eff93"><span class="section-number-3">2.1.</span> Revised how preview windows are deleted</h3>
<div class="outline-text-3" id="text-h:0a4464ac-2f21-4c1e-8202-3bfe0b4eff93">
<p>
In the past, <code>dired-preview-mode</code> could delete windows that held
another buffer, thus undoing the window layout that was present before
a preview buffer was displayed. Now <code>dired-preview-mode</code> makes sure to
only delete windows that have not had another buffer shown in them,
i.e. windows that were created just for preview purposes.
</p>
</div>
</div>
<div id="outline-container-h:c5c0206a-57ce-4ad5-a74f-96275b8aaaf2" class="outline-3">
<h3 id="h:c5c0206a-57ce-4ad5-a74f-96275b8aaaf2"><span class="section-number-3">2.2.</span> Directories no longer get misunderstood as &ldquo;large files&rdquo;</h3>
<div class="outline-text-3" id="text-h:c5c0206a-57ce-4ad5-a74f-96275b8aaaf2">
<p>
We tweaked how we test the type of the buffer-to-be-preview such that
directories are not mistaken for &ldquo;large files&rdquo;. This was an issue for
Mac computers that Sean Devlin brought to my attention in issue 27:
<a href="https://github.com/protesilaos/dired-preview/issues/27">https://github.com/protesilaos/dired-preview/issues/27</a>.
</p>
</div>
</div>
<div id="outline-container-h:4dcf8881-9c07-4a8e-93fa-24bedfd61db2" class="outline-3">
<h3 id="h:4dcf8881-9c07-4a8e-93fa-24bedfd61db2"><span class="section-number-3">2.3.</span> The <code>dired-preview-delay</code> has a 0.1 second minimum to avoid instability</h3>
<div class="outline-text-3" id="text-h:4dcf8881-9c07-4a8e-93fa-24bedfd61db2">
<p>
A value of 0 could lead to a noticeably degraded experience while
navigating the Dired buffer. Thanks to Yiyu Zhou for reporting the
matter in issue 2 on the GitLab mirror:
<a href="https://gitlab.com/protesilaos/dired-preview/-/issues/2">https://gitlab.com/protesilaos/dired-preview/-/issues/2</a>.
</p>
</div>
</div>
<div id="outline-container-h:4d1b5c14-eb7d-473b-955a-3b3068b1a9ed" class="outline-3">
<h3 id="h:4d1b5c14-eb7d-473b-955a-3b3068b1a9ed"><span class="section-number-3">2.4.</span> Files without an extension can also be ignored</h3>
<div class="outline-text-3" id="text-h:4d1b5c14-eb7d-473b-955a-3b3068b1a9ed">
<p>
The user option <code>dired-preview-ignored-extensions-regexp</code> will now
also match files without an extension, such as the <code>.DS_Store</code> on Mac
computers.
</p>

<p>
Thanks to Sean Devlin for the contribution in pull request 26:
<a href="https://github.com/protesilaos/dired-preview/pull/26">https://github.com/protesilaos/dired-preview/pull/26</a>. The change is
within the ~15-line limit, meaning that Sean does not need to assign
copyright to the Free Software Foundation.
</p>
</div>
</div>
<div id="outline-container-h:7eb9ced9-03a7-4436-9392-6352737aee15" class="outline-3">
<h3 id="h:7eb9ced9-03a7-4436-9392-6352737aee15"><span class="section-number-3">2.5.</span> The preview buffer is the &ldquo;other window&rdquo; for scrolling purposes</h3>
<div class="outline-text-3" id="text-h:7eb9ced9-03a7-4436-9392-6352737aee15">
<p>
The commands which scroll the other window, such as
<code>scroll-other-window</code> now operate on the preview buffer when that is
displayed. Thanks to Karthik Chikmagalur for proposing this in issue
24: <a href="https://github.com/protesilaos/dired-preview/issues/24">https://github.com/protesilaos/dired-preview/issues/24</a>.
</p>

<p>
This is in addition to the commands we already provided for scrolling
the preview window, namely, <code>dired-preview-page-up</code> and <code>dired-preview-page-down</code>.
Do <code>M-x describe-keymap</code> and then search for <code>dired-preview-mode-map</code>:
it is in effect when <code>dired-preview-mode</code> is enabled.
</p>
</div>
</div>
</div>
<div id="outline-container-h:af454ee4-dcae-4a76-80c7-d4f9be7730c7" class="outline-2">
<h2 id="h:af454ee4-dcae-4a76-80c7-d4f9be7730c7"><span class="section-number-2">3.</span> Version 0.4.0 on 2025-02-18</h2>
<div class="outline-text-2" id="text-h:af454ee4-dcae-4a76-80c7-d4f9be7730c7">
<p>
This version contains several refinements and bug fixes.
</p>
</div>
<div id="outline-container-h:309a2e0b-866a-45a6-b262-2d9f4c74531a" class="outline-3">
<h3 id="h:309a2e0b-866a-45a6-b262-2d9f4c74531a"><span class="section-number-3">3.1.</span> Preview buffers have a mode line indicator</h3>
<div class="outline-text-3" id="text-h:309a2e0b-866a-45a6-b262-2d9f4c74531a">
<p>
Preview buffers have a prefix to their name to make them stand out.
This is controlled by the user option <code>dired-preview-buffer-name-indicator</code>,
which is a string that defaults to <code>[P]</code>.
</p>
</div>
</div>
<div id="outline-container-h:7e173b76-ee7b-4720-8ab3-06664f5decee" class="outline-3">
<h3 id="h:7e173b76-ee7b-4720-8ab3-06664f5decee"><span class="section-number-3">3.2.</span> Control how preview buffers are cleaned up</h3>
<div class="outline-text-3" id="text-h:7e173b76-ee7b-4720-8ab3-06664f5decee">
<p>
The way <code>dired-preview</code> works is to display a buffer and then keep a
list of preview buffers to economise on redisplaying it again. This
list of buffers is relevant for as long as we are in the Dired buffer,
otherwise all buffers therein are killed (buffers that were alive
before being previewed are not touched).
</p>

<p>
By default we delete from oldest to newest the accumulated buffers
when they exceed <code>10</code> in total. Though users can modify this behaviour
by editing the value of the new user option <code>dired-preview-kill-buffers-method</code>
(its doc string explains the technicalities).
</p>

<p>
Thanks to artelse for discussing this with me in issue 20:
<a href="https://github.com/protesilaos/dired-preview/issues/20">https://github.com/protesilaos/dired-preview/issues/20</a>.
</p>
</div>
</div>
<div id="outline-container-h:a51e6649-1f36-4f5b-9525-5541367d7bea" class="outline-3">
<h3 id="h:a51e6649-1f36-4f5b-9525-5541367d7bea"><span class="section-number-3">3.3.</span> The <code>dired-preview-display-action-alist</code> has a new optional function</h3>
<div class="outline-text-3" id="text-h:a51e6649-1f36-4f5b-9525-5541367d7bea">
<p>
The <code>dired-preview-display-action-alist</code> is the user option which
controls where the preview window is displayed. Its value can either
be the symbol of a function or a <code>display-buffer-alist</code> entry.
</p>

<p>
By default, we have a &ldquo;do-what-I-mean&rdquo; function that tries to find a
good placement for the window. The new <code>dired-preview-display-action-alist-below</code>
function has a straightforward behaviour: it always shows the preview
below the current window and it always makes the preview window 0.3
times the height of the Emacs frame.
</p>
</div>
</div>
<div id="outline-container-h:e93c9c41-c1ad-4e88-945a-c42962441bbe" class="outline-3">
<h3 id="h:e93c9c41-c1ad-4e88-945a-c42962441bbe"><span class="section-number-3">3.4.</span> Encypted files are no longer previewed</h3>
<div class="outline-text-3" id="text-h:e93c9c41-c1ad-4e88-945a-c42962441bbe">
<p>
This is to ensure that potentially sensitive contents are not
displayed by accident, such as during a video call.
</p>
</div>
</div>
<div id="outline-container-h:ec1bfadc-728e-4605-a8d7-25d1c595f9a1" class="outline-3">
<h3 id="h:ec1bfadc-728e-4605-a8d7-25d1c595f9a1"><span class="section-number-3">3.5.</span> We no longer preview the &ldquo;self&rdquo; directory</h3>
<div class="outline-text-3" id="text-h:ec1bfadc-728e-4605-a8d7-25d1c595f9a1">
<p>
We should not trigger a preview when the cursor is over the implicit
<code>.</code> directory, as that causes a recursion that breaks things. Thanks
to Inkbottle007 for reporting the bug in issue 23:
<a href="https://github.com/protesilaos/dired-preview/issues/23">https://github.com/protesilaos/dired-preview/issues/23</a>.
</p>
</div>
</div>
<div id="outline-container-h:078acf4c-cf38-4053-befd-600476970d1a" class="outline-3">
<h3 id="h:078acf4c-cf38-4053-befd-600476970d1a"><span class="section-number-3">3.6.</span> Miscellaneous</h3>
<div class="outline-text-3" id="text-h:078acf4c-cf38-4053-befd-600476970d1a">
<ul class="org-ul">
<li>Fixed a scenario where we would try to delete the last available
window on the current frame. This should never happen. Thanks to
artelse for reporting a relevant bug in the discussion of issue 22:
<a href="https://github.com/protesilaos/dired-preview/issues/22">https://github.com/protesilaos/dired-preview/issues/22</a>.</li>

<li>Fixed a case when <code>hexl-follow-ascii</code> could fail to find an overlay
under certain conditions. This did not create any noticeable
problems, though having an error there would interfere with any
workflow that would rely on <code>toggle-debug-on-error</code>.</li>

<li>The preview window will automatically be closed if the user switches
outside the given Dired buffer. We now do not consider a change to
the minibuffer as being &ldquo;outside&rdquo; this context. This way, a quick
<code>M-x</code> to, say, enable a minor mode does not have any effect on the
window layout.</li>

<li>Suppressed the messaging facility of the underlying tracking of
preview buffers. Otherwise, Dired would notify us that the directory
has changed whenever we would preview a new one, which is
superfluous.</li>

<li>The body of the <code>dired-preview-trigger</code> function, which determines
whether a preview will be displayed, is encapsulated in a <code>condition-case</code>.
This helps capture errors and thus have a more predictable behaviour.</li>

<li>The <code>dired-preview-display-action-alist</code> has a more accurate
declaration which allows for its correct customisation inside the
Custom UI interface. In particular, it will behave the same way as
the <code>display-buffer-alist</code>, where relevant.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:d9780c65-4e70-4188-ae17-abdef97f7ea9" class="outline-2">
<h2 id="h:d9780c65-4e70-4188-ae17-abdef97f7ea9"><span class="section-number-2">4.</span> Version 0.3.0 on 2024-09-16</h2>
<div class="outline-text-2" id="text-h:d9780c65-4e70-4188-ae17-abdef97f7ea9">
<p>
This version brings some nice new features and makes small refinements
to the code base.
</p>
</div>
<div id="outline-container-h:4d4e2b08-df93-4738-936b-70de1a056def" class="outline-3">
<h3 id="h:4d4e2b08-df93-4738-936b-70de1a056def"><span class="section-number-3">4.1.</span> Run commands in the preview window</h3>
<div class="outline-text-3" id="text-h:4d4e2b08-df93-4738-936b-70de1a056def">
<p>
The <code>dired-preview-mode-map</code> is active when <code>dired-preview-mode</code> is
enabled. Here are all the keys and corresponding commands it provides
right now:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Key binding</th>
<th scope="col" class="org-left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">C-c C-c</td>
<td class="org-left">dired-preview-hexl-toggle</td>
</tr>

<tr>
<td class="org-left">C-c C-d</td>
<td class="org-left">dired-preview-page-down</td>
</tr>

<tr>
<td class="org-left">C-c C-f</td>
<td class="org-left">dired-preview-find-file</td>
</tr>

<tr>
<td class="org-left">C-c C-o</td>
<td class="org-left">dired-preview-open-dwim</td>
</tr>

<tr>
<td class="org-left">C-c C-u</td>
<td class="org-left">dired-preview-page-up</td>
</tr>
</tbody>
</table>

<p>
With the exception of <code>dired-preview-hexl-toggle</code>, these are all new
commands.
</p>

<p>
My most used command among those is <code>dired-preview-open-dwim</code>, which
has a Do-What-I-Mean behaviour: If the file name matches
<code>dired-preview-media-extensions-regexp</code>,
<code>dired-preview-ignored-extensions-regexp</code>, or
<code>dired-preview-image-extensions-regexp</code>, then it opens it externally.
Otherwise, it visits the file in an Emacs buffer. Note that here we
include the <code>dired-preview-image-extensions-regexp</code> because while
Emacs can visit those in a buffer, it does not offer as much
functionality as other apps that specialise in handling image files.
</p>

<p>
[ Emacs uses the system default for those files when opening them externally. ]
</p>
</div>
</div>
<div id="outline-container-h:90b9c693-c217-4760-a102-a7e04308bfd9" class="outline-3">
<h3 id="h:90b9c693-c217-4760-a102-a7e04308bfd9"><span class="section-number-3">4.2.</span> Advanced users can rely on the <code>dired-preview-with-window</code> macro</h3>
<div class="outline-text-3" id="text-h:90b9c693-c217-4760-a102-a7e04308bfd9">
<p>
Use this in your custom functions to run some code with the preview
window as the selected window. For example, here is a simple one from
our code base:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun dired-preview-page-down ()
  "Move a page down in the preview window.
This technically runs `scroll-up-command'."
  (interactive)
  (dired-preview-with-window
    (call-interactively 'scroll-up-command)))
</pre>
</div>

<p>
Remember to add them to the <code>dired-preview-mode-map</code>.
</p>
</div>
</div>
<div id="outline-container-h:8c0034c1-9770-456f-b8db-40fe1db7754f" class="outline-3">
<h3 id="h:8c0034c1-9770-456f-b8db-40fe1db7754f"><span class="section-number-3">4.3.</span> Placeholder window prevents preview jumpiness</h3>
<div class="outline-text-3" id="text-h:8c0034c1-9770-456f-b8db-40fe1db7754f">
<p>
Wtih <code>dired-preview-ignored-extensions-regexp</code> we can exclude certain
files from being previewed. This is useful because, for example, Emacs
cannot display those files or do something useful with their contents,
or we just want to hide them (e.g. to omit GPG-encrypted files from
the preview).
</p>

<p>
In the past, <code>dired-preview-mode</code> would pop up a preview window for a
file that could be previewed and would then hide that window for
anything matching <code>dired-preview-ignored-extensions-regexp</code>. As a
result, windows would jump in and out of the frame layout. This could
be disorienting.
</p>

<p>
We now provide the user option <code>dired-preview-ignored-show-ignored-placeholders</code>
which shows a placeholder window when trying to preview an ignored
file. So as we move up and down the Dired buffer, the preview window
stays in place regardless if we are on an ignored file or not.
</p>

<p>
The default value of <code>dired-preview-ignored-show-ignored-placeholders</code>
is <code>t</code> because I think this is the better behaviour. Though users can
set it to <code>nil</code> to retain the old functionality.
</p>

<p>
Thanks to Álvaro Ramírez (xenodium) for the contribution. This was
done in pull request 15: <a href="https://github.com/protesilaos/dired-preview/pull/15">https://github.com/protesilaos/dired-preview/pull/15</a>.
</p>

<p>
The change is within the permissible limit of ~15 lines, meaning that
Álvaro does not need to assign copyright to the Free Software
Foundation.
</p>
</div>
</div>
<div id="outline-container-h:250662ef-3fd3-4abe-8cf7-71c72ce4619c" class="outline-3">
<h3 id="h:250662ef-3fd3-4abe-8cf7-71c72ce4619c"><span class="section-number-3">4.4.</span> The <code>dired-preview-display-action-alist</code> replaces <code>dired-preview-display-action-alist-function</code></h3>
<div class="outline-text-3" id="text-h:250662ef-3fd3-4abe-8cf7-71c72ce4619c">
<p>
The old symbol is an alias for the new one and users will be notified
accordingly while updating.
</p>

<p>
This user option is for advanced users who want to customise where and
how <code>display-buffer</code> places the preview window. Before, we were
accepting only the symbol of a function that would return an
appropriate action alist. Now we accept either a function&rsquo;s symbol or
an action alist directly.
</p>

<p>
Examples of both:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; Use a function that returns an action alist:
(setq dired-preview-display-action-alist #'dired-preview-display-action-alist-dwim)

;; Use an action alist directly:
(setq dired-preview-display-action-alist
      '((display-buffer-in-side-window)
        (side . bottom)
        (window-height . 0.2)
        (preserve-size . (t . t))))
</pre>
</div>

<p>
Check our <code>dired-preview-display-action-alist-dwim</code> for inspiration if
you want to have a function that returns an action alist based on,
say, the width of the frame.
</p>
</div>
</div>
<div id="outline-container-h:68fd4a03-7ca9-489c-93bc-efdaf8faaefc" class="outline-3">
<h3 id="h:68fd4a03-7ca9-489c-93bc-efdaf8faaefc"><span class="section-number-3">4.5.</span> Preview of the next file works when marking for deletion</h3>
<div class="outline-text-3" id="text-h:68fd4a03-7ca9-489c-93bc-efdaf8faaefc">
<p>
When we mark a file for deletion, Dired moves the point to the next
line. Before, this would not trigger a preview of the updated
file-at-point. Now it should work as expected.
</p>

<p>
Technically, we check if the last command is among those stored in the
variable <code>dired-preview-trigger-commands</code>. If you think there are
more commands we need to include there, just let me know.
</p>
</div>
</div>
<div id="outline-container-h:a06e0f9b-02d2-4a77-a259-eadaeff33c9e" class="outline-3">
<h3 id="h:a06e0f9b-02d2-4a77-a259-eadaeff33c9e"><span class="section-number-3">4.6.</span> The <code>dired-preview-ignored-extensions-regexp</code> can be <code>nil</code></h3>
<div class="outline-text-3" id="text-h:a06e0f9b-02d2-4a77-a259-eadaeff33c9e">
<p>
This was always the intention, but the relevant code was not
accounting for that scenario. It should work now as intended.
</p>
</div>
</div>
</div>
<div id="outline-container-h:4225d638-f5bb-4855-85c7-972ff40aad6d" class="outline-2">
<h2 id="h:4225d638-f5bb-4855-85c7-972ff40aad6d"><span class="section-number-2">5.</span> Version 0.2.0 on 2024-05-07</h2>
<div class="outline-text-2" id="text-h:4225d638-f5bb-4855-85c7-972ff40aad6d">
<p>
This release brings many small improvements and fixes some bugs.
</p>
</div>
<div id="outline-container-h:e3652b69-aa81-4b71-9887-81052ff7f9f7" class="outline-3">
<h3 id="h:e3652b69-aa81-4b71-9887-81052ff7f9f7"><span class="section-number-3">5.1.</span> The preview shows up right away on new directories</h3>
<div class="outline-text-3" id="text-h:e3652b69-aa81-4b71-9887-81052ff7f9f7">
<p>
In the past, entering a new directory would not trigger a preview: it
would wait for some motion before doing so. This could make it seem
that the mode was not enabled in the current buffer. Now, the preview
shows up immediately.
</p>

<p>
Thanks to Nofint for the initial contribution in pull request 8:
<a href="https://github.com/protesilaos/dired-preview/pull/8">https://github.com/protesilaos/dired-preview/pull/8</a>. The changes are
small and do not require copyright assignment to the Free Software
Foundation.
</p>
</div>
</div>
<div id="outline-container-h:8dae8cba-3ca7-43be-a4ba-5dd938b37f82" class="outline-3">
<h3 id="h:8dae8cba-3ca7-43be-a4ba-5dd938b37f82"><span class="section-number-3">5.2.</span> Directories are previewed as well</h3>
<div class="outline-text-3" id="text-h:8dae8cba-3ca7-43be-a4ba-5dd938b37f82">
<p>
The contents are displayed in a Dired buffer, using the current
settings for it. This means that colours are possible icons are shown
too.
</p>
</div>
</div>
<div id="outline-container-h:b4928def-5392-4e7b-8cb5-ed5c238b1b5e" class="outline-3">
<h3 id="h:b4928def-5392-4e7b-8cb5-ed5c238b1b5e"><span class="section-number-3">5.3.</span> Large files are previewed in <code>hexl-mode</code></h3>
<div class="outline-text-3" id="text-h:b4928def-5392-4e7b-8cb5-ed5c238b1b5e">
<p>
As the documentation of this mode suggests:
</p>

<blockquote>
<p>
A mode for editing binary files in hex dump format.
This is not an ordinary major mode; it alters some aspects
of the current mode’s behavior, but not all; also, you can exit
Hexl mode and return to the previous mode using C-c C-c.
</p>
</blockquote>

<p>
The <code>C-c C-c</code> key binding toggles the mode, in case you want to see
the raw output.
</p>

<p>
Thanks to Karthik Chikmagalur for the contribution. This was done on
the now defunct mailing list:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3C871qeb56bw.fsf@gmail.com%3E">https://lists.sr.ht/~protesilaos/general-issues/%3C871qeb56bw.fsf@gmail.com%3E</a>.
</p>
</div>
</div>
<div id="outline-container-h:ea324fd1-f808-420f-b019-250e161465ff" class="outline-3">
<h3 id="h:ea324fd1-f808-420f-b019-250e161465ff"><span class="section-number-3">5.4.</span> Previews are displayed in a full-featured mode</h3>
<div class="outline-text-3" id="text-h:ea324fd1-f808-420f-b019-250e161465ff">
<p>
Before, we would delay the execution of the mode hooks to speed things
up. Though this came at the cost of (i) making the buffer less capable
and (ii) forcing us to handle the execution of those hooks at a later
stage when they would be needed, which proved to be error-prone in a
number of scenaria.
</p>
</div>
</div>
<div id="outline-container-h:a4d6b125-5ef6-409d-aded-e7b1971ac87d" class="outline-3">
<h3 id="h:a4d6b125-5ef6-409d-aded-e7b1971ac87d"><span class="section-number-3">5.5.</span> Files without an extension are still previewed</h3>
<div class="outline-text-3" id="text-h:a4d6b125-5ef6-409d-aded-e7b1971ac87d">
<p>
This is a bug fix. Before, they would be considered as part of the
files to be ignored, per <code>dired-preview-ignored-extensions-regexp</code>.
</p>
</div>
</div>
<div id="outline-container-h:67d61ed2-3e16-49a9-bd3a-61950d9ab81b" class="outline-3">
<h3 id="h:67d61ed2-3e16-49a9-bd3a-61950d9ab81b"><span class="section-number-3">5.6.</span> Previews are not added to what <code>recentf-mode</code> tracks</h3>
<div class="outline-text-3" id="text-h:67d61ed2-3e16-49a9-bd3a-61950d9ab81b">
<p>
Thanks to Juergen Hoetzel for reporting this issue and for tweaking my
suggested patch for it. This was done in pull request 12:
<a href="https://github.com/protesilaos/dired-preview/pull/12">https://github.com/protesilaos/dired-preview/pull/12</a>. The change is
small, so Juergen does not need to assign copyright to the Free
Software Foundation.
</p>
</div>
</div>
<div id="outline-container-h:493488b1-0f7d-4b44-b96d-4cd9a6bde352" class="outline-3">
<h3 id="h:493488b1-0f7d-4b44-b96d-4cd9a6bde352"><span class="section-number-3">5.7.</span> A nil value for <code>split-width-threshold</code> still works</h3>
<div class="outline-text-3" id="text-h:493488b1-0f7d-4b44-b96d-4cd9a6bde352">
<p>
We no longer consider this an error and adapt the preview accordingly.
Thanks to Juergen Hoetzel for the contribution. This was done in pull
request 11 and does not require copyright assignment:
<a href="https://github.com/protesilaos/dired-preview/pull/11">https://github.com/protesilaos/dired-preview/pull/11</a>.
</p>
</div>
</div>
<div id="outline-container-h:d8c42eea-a540-44fd-91b4-138fdba47288" class="outline-3">
<h3 id="h:d8c42eea-a540-44fd-91b4-138fdba47288"><span class="section-number-3">5.8.</span> For developers: previews are done with <code>cl-defmethod</code></h3>
<div class="outline-text-3" id="text-h:d8c42eea-a540-44fd-91b4-138fdba47288">
<p>
Each file type will thus have its own method on how to display the
contents in a buffer. The idea is to make this easier to extend. The
goal is to have methods that can preview PDFs and images without
blocking Emacs. Other file types can be considered as well, though
those two are the immediate priority.
</p>
</div>
</div>
</div>
<div id="outline-container-h:99cbb3dd-a0f1-4d2b-a945-58531f4ab189" class="outline-2">
<h2 id="h:99cbb3dd-a0f1-4d2b-a945-58531f4ab189"><span class="section-number-2">6.</span> Version 0.1.0 on 2023-07-08</h2>
<div class="outline-text-2" id="text-h:99cbb3dd-a0f1-4d2b-a945-58531f4ab189">
<p>
The <code>dired-preview</code> package was in a public testing phase from
2023-06-25 until today.  In the meantime, lots of changes have been
made in the interest of usability and robustness.
</p>
</div>
<div id="outline-container-h:598de101-5c1f-4fbd-8f27-709375d8950b" class="outline-3">
<h3 id="h:598de101-5c1f-4fbd-8f27-709375d8950b"><span class="section-number-3">6.1.</span> Global and buffer-local modes</h3>
<div class="outline-text-3" id="text-h:598de101-5c1f-4fbd-8f27-709375d8950b">
<p>
The <code>dired-preview-mode</code> is a local minor mode, while
<code>dired-preview-global-mode</code> is its global counterpart.  Both only take
effect in Dired buffers.
</p>

<p>
The idea for a global and a local mode is to empower the user to
toggle the functionality on demand, such as when they are in a meeting
and want to disable/enable previews in a given context.
</p>

<p>
During the development phase, I had made an error regarding the scope
of what should be a local minor mode.  Thanks to Christian Tietze for
pointing it out: <a href="https://lists.sr.ht/~protesilaos/general-issues/%3Cm1zg4noej2.fsf%40christiantietze.de%3E">https://lists.sr.ht/~protesilaos/general-issues/%3Cm1zg4noej2.fsf%40christiantietze.de%3E</a>.
</p>
</div>
</div>
<div id="outline-container-h:b80cc550-24ee-4817-be8c-c24c5e98e4c2" class="outline-3">
<h3 id="h:b80cc550-24ee-4817-be8c-c24c5e98e4c2"><span class="section-number-3">6.2.</span> Preview delay runs on an idle timer</h3>
<div class="outline-text-3" id="text-h:b80cc550-24ee-4817-be8c-c24c5e98e4c2">
<p>
Originally, previews would run on a timer that would block Emacs.
Whereas we now arrange to only trigger a preview when Emacs is idle
for a customisable amount of seconds.  Refer to the user option
<code>dired-preview-delay</code>.
</p>
</div>
</div>
<div id="outline-container-h:c298121a-5ba4-408b-b063-14022c307c47" class="outline-3">
<h3 id="h:c298121a-5ba4-408b-b063-14022c307c47"><span class="section-number-3">6.3.</span> Trigger a preview in the post-command phase</h3>
<div class="outline-text-3" id="text-h:c298121a-5ba4-408b-b063-14022c307c47">
<p>
In the original design, previews were triggered by bespoke
<code>dired-preview</code> commands that were remapped to <code>n</code> and <code>p</code> in Dired
buffers.  This had several downsides, namely, (i) the other motions
would not pick up the trigger, (ii) we would have to remap all
possible motions, and (iii) the code was needlessly complex.
</p>

<p>
Currently, we install a local hook in the post-command phase, which
will trigger a preview if the previous command was a Dired motion.  In
future versions, we may expand the list of commands that we check for.
</p>

<p>
Thanks to Peter Prevos for reporting this in issue 1 on the GitHub
mirror: <a href="https://github.com/protesilaos/dired-preview/issues/1">https://github.com/protesilaos/dired-preview/issues/1</a>.
</p>

<p>
Thanks to Christian Tietze and Ed Hamilton for discussing this topic
with me on the mailing list:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3Cm1zg4noej2.fsf%40christiantietze.de%3E">https://lists.sr.ht/~protesilaos/general-issues/%3Cm1zg4noej2.fsf%40christiantietze.de%3E</a>.
Commit ae93720 by Christian Tietze is based on this discussion,
although the implementation details have since been redone.
</p>

<p>
During the development phase, I had made the mistake of checking the
<code>last-command</code>, whereas I should be testing against the
<code>this-command</code>.  Thanks to Karthik Chikmagalur for pointing out my
error:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3C87sfab8ixn.fsf%40gmail.com%3E">https://lists.sr.ht/~protesilaos/general-issues/%3C87sfab8ixn.fsf%40gmail.com%3E</a>.
</p>
</div>
</div>
<div id="outline-container-h:3033401f-878d-4298-9256-228d6c249b3a" class="outline-3">
<h3 id="h:3033401f-878d-4298-9256-228d6c249b3a"><span class="section-number-3">6.4.</span> The placement of the preview window is customisable</h3>
<div class="outline-text-3" id="text-h:3033401f-878d-4298-9256-228d6c249b3a">
<p>
We arrange to display previews in a side window.  Due to the inherent
complexity of the <code>display-buffer</code> function and its accoutrements, a
user option is necessarily reserved for experienced users.  To this
end, we provide the <code>dired-preview-display-action-alist-function</code>.
Refer to the <code>dired-preview-display-action-alist-dwim</code> function for
the implementation details.
</p>

<p>
Thanks to Karthik Chikmagalur for making an initial suggestion about
such a feature:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3C87jzvp484n.fsf%40gmail.com%3E">https://lists.sr.ht/~protesilaos/general-issues/%3C87jzvp484n.fsf%40gmail.com%3E</a>
</p>

<p>
Thanks to Bruno Boal for discussing the user option and concomitant
function with me and for checking the relevant definitions.  This was
done via a private channel and the information is shared with
permission.
</p>
</div>
</div>
<div id="outline-container-h:06e6249d-8755-450e-b65e-b8f999d982a4" class="outline-3">
<h3 id="h:06e6249d-8755-450e-b65e-b8f999d982a4"><span class="section-number-3">6.5.</span> Window placement and deletion is more robust</h3>
<div class="outline-text-3" id="text-h:06e6249d-8755-450e-b65e-b8f999d982a4">
<p>
The idea of &ldquo;preview&rdquo; windows is that they are not ordinary windows
that the user can interact with.  As such, they are to be deleted when
some non-preview mode of action is taken.
</p>

<p>
Testing for such cases was extensive and required lots of changes to
the code base.  Thanks to Bruno Boal for performing the tests with me,
for brainstorming possible solutions, and for inspecting the
implementation details.  This was done via a private channel and the
information is shared with permission.
</p>
</div>
</div>
<div id="outline-container-h:a2ee3d09-7356-465c-8627-bdc56e9ec303" class="outline-3">
<h3 id="h:a2ee3d09-7356-465c-8627-bdc56e9ec303"><span class="section-number-3">6.6.</span> We no longer try to preview irregular files</h3>
<div class="outline-text-3" id="text-h:a2ee3d09-7356-465c-8627-bdc56e9ec303">
<p>
Before, <code>dired-preview</code> would attempt to produce a preview of named
pipes and sockets.  This was not intended and has since been
addressed.  Use &rsquo;file-regular-p&rsquo; instead of &rsquo;file-exists-p&rsquo;
</p>

<p>
Thanks to Karthik Chikmagalur for bringing this matter to my attention
and for recommending the use of <code>file-regular-p</code> instead of
<code>file-exists-p</code>:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3C87pm5cnpaf.fsf%40gmail.com%3E">https://lists.sr.ht/~protesilaos/general-issues/%3C87pm5cnpaf.fsf%40gmail.com%3E</a>.
</p>
</div>
</div>
<div id="outline-container-h:d8ba0949-76b0-4d3a-b0f3-1bfb62280483" class="outline-3">
<h3 id="h:d8ba0949-76b0-4d3a-b0f3-1bfb62280483"><span class="section-number-3">6.7.</span> Preview buffers are killed up to a cumulative size threshold</h3>
<div class="outline-text-3" id="text-h:d8ba0949-76b0-4d3a-b0f3-1bfb62280483">
<p>
In the original design, we were killing preview buffers all at once.
This was wasteful because all the work we were doing in the background
to, for example, fetch a large file was discarded even though the user
could theoretically request another preview of it.
</p>

<p>
The current approach is to keep around the newer buffers in order to
speed up potential requests for another preview.  Older buffers are
discarded starting from the oldest.  The clearance of older buffers is
done until we reach a cumulative size of what is specified as the
value of the variable <code>dired-preview--buffers-threshold</code>.
</p>

<p>
Note that the symbol includes double dashes, meaning that it is
intended for &ldquo;private&rdquo; (internal) purposes.  I am mentioning it here,
because this seems like a good candidate for a future user option,
subject to further refinements.
</p>

<p>
Thanks to Bruno Boal for suggesting this idea and checking its
implementation with me.  This was done via a private channel and the
information is shared with permission.
</p>
</div>
</div>
</div>
